{"version":3,"sources":["/source/backbone-metal.js","backbone-metal.min.js"],"names":["global","factory","exports","module","require","define","amd","Metal","Backbone","_","this","_wrap","method","superMethod","prevSuper","_super","ret","apply","arguments","_wrapAll","dest","source","keys","length","i","undefined","name","hasSuper","CONTAINS_SUPER","test","isFunction","mixin__Mixin","protoProps","extend","isMixin","value","mixin","Events","events","xyz","_class__Class","cid","uniqueId","cidPrefix","initialize","prototype","destroy","stopListening","staticProps","Parent","Child","has","constructor","Surrogate","superclass","__super__","include","isClass","_class","ERROR_PROPS","Err","call","Error","message","options","isObject","error","pick","captureStackTrace","toString","target","_error","_deprecate__deprecate","_format","prev","next","_cache","_warn","_console","console","_warnMethod","warn","log","backbone_metal","Class","Mixin","deprecate"],"mappings":"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","file":"backbone-metal.min.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('backbone'), require('underscore')) :\n  typeof define === 'function' && define.amd ? define(['backbone', 'underscore'], factory) :\n  global.Metal = factory(global.Backbone, global._)\n}(this, function (Backbone, _) { 'use strict';\n\n  const mixin__Mixin = function Mixin(protoProps) {\n    // Add prototype properties (instance properties) to the class, if supplied.\n    _.extend(this, protoProps);\n  };\n\n  /**\n   * Checks if `value` is a Metal Mixin.\n   *\n   * ```js\n   * Mixin.isMixin(new Mixin());\n   * // >> true\n   * Mixin.isMixin({});\n   * // >> false\n   * Mixin.isMixin(function() {...});\n   * // >> false\n   * Mixin.isMixin(new Class());\n   * // >> false\n   * ```\n   *\n   * @public\n   * @method isMixin\n   * @memberOf _\n   * @param {*} value - The value to check.\n   */\n  mixin__Mixin.isMixin = function isMixin(value) {\n    return !!value && value instanceof mixin__Mixin;\n  };\n\n  var mixin = mixin__Mixin;\n\n  const Events = new mixin(Backbone.Events);\n\n  var events = Events;\n\n  function _wrap(method, superMethod) {\n    return function() {\n      let prevSuper = this._super;\n      this._super = superMethod;\n      let ret = method.apply(this, arguments);\n      this._super = prevSuper;\n      return ret;\n    };\n  }\n\n  /**\n   * A reference to safe regex for checking if a function calls `_super`.\n   *\n   * @private\n   * @const {RegExp}\n   */\n  const CONTAINS_SUPER = (/xyz/.test(function() { xyz; })) ? /\\b_super\\b/ : /.*/; // eslint-disable-line\n\n  /**\n   * Assigns properties of source object to destination object, wrapping methods\n   * that call their super method.\n   *\n   * @private\n   * @method wrapAll\n   * @param {Object} dest - The destination object.\n   * @param {Object} source - The source object.\n   */\n  function _wrapAll(dest, source) {\n    let keys = _.keys(source),\n        length = keys.length,\n        i, name, method, superMethod, hasSuper;\n\n    for (i = 0; i < length; i++) {\n      name = keys[i];\n      method = source[name];\n      superMethod = dest[name];\n\n      // Test if new method calls `_super`\n      hasSuper = CONTAINS_SUPER.test(method);\n\n      // Only wrap the new method if the original method was a function and the\n      // new method calls `_super`.\n      if (hasSuper && _.isFunction(method) && _.isFunction(superMethod)) {\n        dest[name] = _wrap(method, superMethod);\n\n      // Otherwise just add the new method or property to the object.\n      } else {\n        dest[name] = method;\n      }\n    }\n  }\n\n  /**\n   * Creates a new Class.\n   *\n   * ```js\n   * const MyClass = Class.extend({\n   *   initialize() {\n   *     console.log('Created!');\n   *   }\n   * });\n   *\n   * new MyClass();\n   * // >> Created!\n   * ```\n   *\n   * @public\n   * @class Class\n   * @memberOf Metal\n   * @memberOf Backbone\n   */\n  const _class__Class = function Class() {\n    this.cid = _.uniqueId(this.cidPrefix);\n    this.initialize(...arguments);\n  };\n\n  _.extend(_class__Class.prototype, {\n\n    /**\n     * Identifier prefix of the cid. It can be override.\n     *\n     * @public\n     * @attributeOf Class {String}\n     */\n    cidPrefix: 'metal',\n\n    /**\n     * An overridable method called when objects are instantiated. Does not do\n     * anything by default.\n     *\n     * @public\n     * @abstract\n     * @method initialize\n     */\n    initialize: function() {},\n\n    /**\n     * Destroy a Class by removing all listeners.\n     *\n     * @public\n     * @method destroy\n     */\n    destroy() {\n      this.stopListening();\n    }\n  });\n\n  _.extend(_class__Class, {\n\n    /**\n     * Creates a new subclass.\n     *\n     * ```js\n     * const MyClass = Class.extend({\n     *   // ...\n     * });\n     *\n     * const myClass = new MyClass();\n     * myClass instanceof MyClass\n     * // true\n     * myClass instanceof Class\n     * // true\n     * ```\n     *\n     * @public\n     * @static\n     * @method extend\n     * @param {Object} [protoProps] - The properties to be added to the prototype.\n     * @param {Object} [staticProps] - The properties to be added to the constructor.\n     */\n    extend(protoProps, staticProps) {\n      let Parent = this;\n      let Child;\n\n      // The constructor function for the new subclass is either defined by you\n      // (the \"constructor\" property in your `extend` definition), or defaulted\n      // by us to simply call the parent's constructor.\n      if (!protoProps || !_.has(protoProps, 'constructor')) {\n        Child = function() { Parent.apply(this, arguments); };\n      } else if (CONTAINS_SUPER.test(protoProps.constructor)) {\n        Child = _wrap(protoProps.constructor, Parent.prototype.constructor);\n      } else {\n        Child = protoProps.constructor;\n      }\n\n      // Add static properties to the constructor function, if supplied.\n      _.extend(Child, Parent);\n      if (staticProps) {\n        _wrapAll(Child, staticProps);\n      }\n\n      // Set the prototype chain to inherit from `parent`, without calling\n      // `parent`'s constructor function.\n      let Surrogate = function() {\n        this.constructor = Child;\n      };\n\n      Surrogate.prototype = Parent.prototype;\n      Child.prototype = new Surrogate();\n\n      // Add prototype properties (instance properties) to the subclass,\n      // if supplied.\n      if (protoProps) {\n        _wrapAll(Child.prototype, protoProps);\n      }\n\n      // Set a convenience property in case the parent class is needed later.\n      Child.superclass = Parent;\n\n      // Set a convenience property in case the parent's prototype is needed\n      // later.\n      Child.__super__ = Parent.prototype;\n\n      return Child;\n    },\n\n    /**\n     * Mixes properties onto the class's prototype.\n     *\n     * ```js\n     * const MyMixin = new Mixin({\n     *   alert() {\n     *     console.log('Alert!');\n     *   }\n     * });\n     *\n     * const MyClass = Class.extend({\n     *   initialize() {\n     *     this.alert();\n     *   }\n     * });\n     *\n     * MyClass.mixin(MyMixin);\n     *\n     * new MyClass();\n     * // >> Alert!\n     * ```\n     *\n     * @public\n     * @static\n     * @method mixin\n     * @param {Object} protoProps - The properties to be added to the prototype.\n     * @return {Class} - The class.\n     */\n    mixin(protoProps) {\n      // Add prototype properties (instance properties) to the class, if supplied.\n      _wrapAll(this.prototype, protoProps);\n      return this;\n    },\n\n    /**\n     * Mixes properties onto the class's constructor.\n     *\n     * ```js\n     * const MyMixin = new Mixin({\n     *   alert() {\n     *     console.log('Alert!');\n     *   }\n     * });\n     *\n     * const MyClass = Class.extend(...);\n     *\n     * MyClass.include(MyMixin);\n     *\n     * MyClass.alert();\n     * // >> Alert!\n     * ```\n     *\n     * You can also simply pass a plain javascript object.\n     *\n     * ```js\n     * const MyClass = Class.extend(...);\n     *\n     * MyClass.include({\n     *   alert() {\n     *     console.log('Alert!');\n     *   }\n     * });\n     *\n     * MyClass.alert();\n     * // >> Alert!\n     * ```\n     *\n     * @public\n     * @static\n     * @method mixin\n     * @param {Object} staticProps - The properties to be added to the constructor.\n     * @return {Class} - The class.\n     */\n    include(staticProps) {\n      // Add static properties to the constructor function, if supplied.\n      _wrapAll(this, staticProps);\n      return this;\n    },\n\n    /**\n     * Checks if `value` is a Metal Class.\n     *\n     * ```js\n     * Class.isClass(Class.extend(...));\n     * // >> true\n     * Class.isClass(new Class());\n     * // >> true\n     * Class.isClass(function() {...});\n     * // >> false\n     * Class.isClass({...});\n     * // >> false\n     * ```\n     * @public\n     * @method isClass\n     * @memberOf _\n     * @param {*} value - The value to check.\n     */\n    isClass(value) {\n      return !!value && (\n        value instanceof _class__Class ||\n        value.prototype instanceof _class__Class ||\n        value === _class__Class\n      );\n    }\n  });\n\n  /**\n   * @class Class\n   * @mixes Events\n   */\n  _class__Class.mixin(events);\n\n  var _class = _class__Class;\n\n  const ERROR_PROPS = [\n    'description', 'fileName', 'lineNumber', 'name', 'message', 'number'\n  ];\n\n  /**\n   * A subclass of the JavaScript Error.\n   *\n   * ```js\n   * throw new Metal.Error('Oh you\\'ve really done it now...');\n   * // Uncaught Metal.Error: Oh you've really done it now...\n   * //   [stack trace]\n   * ```\n   *\n   * @class Error\n   * @memberOf Metal\n   * @extends Error\n   * @uses Metal.Class\n   */\n  const Err = _class.extend.call(Error, {\n\n    /**\n     * @public\n     * @constructs Error\n     * @param {String} [message] - A description of the error.\n     * @param {Object} [options] - Settings for the error.\n     * @param {String} [options.message] - A description of the error.\n     */\n    constructor(message, options = {}) {\n      // If options are provided in place of a message, assume message exists on\n      // options.\n      if (_.isObject(message)) {\n        options = message;\n        message = options.message;\n      }\n\n      // Create a fake error with message in order to capture a stack trace.\n      let error = Error.call(this, message);\n\n      // Copy over all the error-related properties.\n      _.extend(this, _.pick(error, ERROR_PROPS), _.pick(options, ERROR_PROPS));\n\n      // Adds a `stack` property to the given error object that will yield the\n      // stack trace at the time captureStackTrace was called.\n      // When collecting the stack trace all frames above the topmost call\n      // to this function, including that call, will be left out of the\n      // stack trace.\n      // This is useful because we can hide Metal implementation details\n      // that are not very helpful for the user.\n      Err.captureStackTrace(this, Err);\n    },\n\n    /**\n     * Formats the error message to display in the console.\n     *\n     * @public\n     * @method toString\n     * @returns {String} - Formatted error message.\n     */\n    toString() {\n      return `${this.name}: ${this.message}`;\n    }\n  }, {\n\n    /**\n     * A safe reference to V8's `Error.captureStackTrace`.\n     *\n     * @public\n     * @method captureStackTrace\n     */\n    captureStackTrace(target, method) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(target, method);\n      }\n    }\n  });\n\n  /**\n   * @class Error\n   * @mixes Class\n   */\n  _.extend(Err, _class);\n\n  var _error = Err;\n\n  const _deprecate__deprecate = function deprecate(message, test) {\n\n    // Returns if test is provided and is falsy.\n    if (test !== undefined && test) {\n      return;\n    }\n\n    // If message is provided as an object, format the object into a string.\n    if (_.isObject(message)) {\n      message = _deprecate__deprecate._format(message.prev, message.next);\n    }\n\n    // Ensure that message is a string\n    message = message && message.toString();\n\n    // If deprecation message has not already been warned, send the warning.\n    if (!_deprecate__deprecate._cache[message]) {\n      _deprecate__deprecate._warn(`Deprecation warning: ${message}`);\n      _deprecate__deprecate._cache[message] = true;\n    }\n  };\n\n  /**\n   * Format a message for deprecate.\n   *\n   * @private\n   * @method _format\n   * @memberOf deprecate\n   * @param {String} prev - The deprecated item.\n   * @param {String} next - The replacement for the deprecated item.\n   * @return {String} - The formatted message.\n   */\n  _deprecate__deprecate._format = function _format(prev, next) {\n    return `${prev} is going to be removed in the future. Please use ${next} instead.`;\n  };\n\n  /**\n   * A safe reference to the console object that will fallback to an empty\n   * object.\n   *\n   * @private\n   * @property _console\n   */\n  const _console = typeof console !== 'undefined' ? console : {};\n\n  /**\n   * A safe reference to the console.warn method that will fallback a noop.\n   *\n   * @private\n   * @property _warnMethod\n   */\n  const _warnMethod = _console.warn || _console.log || function() {};\n\n  /**\n   * A safe reference to `console.warn`.\n   *\n   * @private\n   * @method _warn\n   * @memberOf deprecate\n   * @param {*...} - The values to warn in the console.\n   */\n  _deprecate__deprecate._warn = function _warn() {\n    return _warnMethod.apply(_console, arguments);\n  };\n\n  /**\n   * An internal cache to avoid sending the same deprecation warning multiple\n   * times.\n   *\n   * @private\n   * @property _cache\n   * @memberOf deprecate\n   */\n  _deprecate__deprecate._cache = {};\n\n  var _deprecate = _deprecate__deprecate;\n\n  var backbone_metal = Backbone.Metal = {\n    Class,\n    Mixin,\n    Error: _error,\n    deprecate,\n    Events\n  };\n\n  return backbone_metal;\n\n}));\n",null],"sourceRoot":"/source/"}